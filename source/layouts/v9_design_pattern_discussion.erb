<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" name="viewport">
    <meta name="robots" content="noindex">

    <!-- Use title if it's in the page YAML frontmatter -->
    <title><%= title || "GOV.UK Documentation" %></title>

    <!--[if gt IE 8]><!--><%= stylesheet_link_tag :screen, media: 'screen' %><!--<![endif]-->
    <!--[if lte IE 8]><%= stylesheet_link_tag 'screen-old-ie', media: 'screen' %><![endif]-->

    <link rel="canonical" href="<%= config[:tech_docs][:host] %><%= current_page.url %>">

    <%= stylesheet_link_tag :print, media: 'print' %>

    <%= javascript_include_tag :application %>
  </head>

  <body>
    <div class="app-pane">
      <div class="app-pane__header">
        <a href="#content" class="skip-link">Skip to main content</a>

        <header class="header header--full-width">
          <div class="header__container">
            <div class="header__brand">
                <a href="/v9/govuk_design_patterns/">
                <% if config[:tech_docs][:show_govuk_logo] %>
                  <span class="govuk-logo">
                    <img class="govuk-logo__printable-crown" src="/images/gov.uk_logotype_crown_invert_trans.png" height="32" width="36">
                    GOV.UK
                  </span>
                <% end %>
                <span class="header__title">
                  Design Patterns
                </span>
                </a>
            </div>
<!--
            <div class="site-search">
              <input type="text" name="q" id="site-search-text" placeholder="Search patterns">
              <input class="submit" type="submit" value="Search">
            </div>
          -->

          <div data-module="navigation">
            <button type="button" class="header__navigation-toggle js-nav-toggle" aria-controls="navigation" aria-label="Show or hide top level navigation">Menu</button>

            <nav id="navigation" class="header__navigation js-nav" aria-label="Top Level Navigation" aria-hidden="true">
              <ul>
                  <li>
                    <a href="/v9/govuk_design_patterns">
                      About
                    </a>
                  </li>

                  <li class="active">
                    <a href="/v9/govuk_design_patterns/patterns/styles/colour">
                      Patterns
                    </a>
                  </li>

                  <li>
                    <a href="/v9/govuk_design_patterns/community">
                      Community
                    </a>
                  </li>

                  <li>
                    <a href="/v9/govuk_design_patterns/support">
                      Support
                    </a>
                  </li>
              </ul>
            </nav>
          </div>

          </div>
        </header>
      </div>
      <div id="toc-heading" class="toc-show fixedsticky">
        <a href="#toc" class="toc-show__label js-toc-show">
          Table of contents <span class="toc-show__icon"></span>
        </a>
      </div>

      <div class="app-pane__body" data-module="highlighted-nav">

        <div class="app-pane__toc">

        <div class="pattern-search">
          <input type="text" name="q" id="pattern-search-text" placeholder="Search patterns">
          <input class="submit" type="submit" value="Search">
        </div>

          <div class="toc" data-module="table-of-contents">
            <a href="#" class="toc__close js-toc-close">Close</a>
            <nav  id="toc" class="js-toc-list toc__list" aria-labelledby="toc-heading">

<% 
pattern_root = "/v9/govuk_design_patterns/patterns/" 
section_order = ["Styles", "Components", "Pages", "Tasks", "Services"]

# Filter out backlog patterns
# Group patterns into sections
patterns_by_section = sitemap.resources
  .select { |r| 
    r.data.section && 
    # r.data.status != "Backlog" &&
    r.url.start_with?(pattern_root)
  }
  .group_by { |r| r.data.section }

# Create a list of used sections in the order defined in section_order. Any
# sections that are not listed in section_order will appear last. Any sections
# in section_order that are not actually used will not be included.
sections_in_order = patterns_by_section.keys.sort_by do |r|
  section_order.index(r) || Float::INFINITY
end
%>

<ul>
<%
# Loop over the sorted list of sections, and lookup the patterns for that
# section from the original list
sections_in_order.each do |sectionName|
%>
  <li<% if (sectionName == section) %> class="current-section"<% end %>>
    <a href="#<%= sectionName %>"><%= sectionName %></a>

<%

  patterns_by_theme = patterns_by_section[sectionName].group_by { |r| r.data.theme  || "Other"}

  patterns_by_theme.each do |theme, arr|

%>

    <ul>
      <% if theme != "Other" %>
      <li class="theme-heading"><%= theme %></li>
      <% end %>
      <% arr.sort_by{|res| res.data.title}.each do |res| %>
        <li class="<% if (url == res.url) %>current-page <% end %>status-<%= res.data.status.downcase.tr(" ", "-") %>"><%= link_to res.data.title, res.url %></li>
      <% end %>
    </ul>

<% end %>
    
  </li>

<% end %>
<ul>

<h3 class="nav-group">Other design patterns</h3>

<ul>
  <li<% if (current_page.path == "v9/govuk_design_patterns/departmental_patterns/index.html") %> class="current-page"<% end %>><a href="/v9/govuk_design_patterns/departmental_patterns">Departmental  patterns</a></li>
  <li<% if (current_page.path == "v9/govuk_design_patterns/backlog/index.html") %> class="current-page"<% end %>><a href="/v9/govuk_design_patterns/backlog">Patterns backlog</a></li>
  <li<% if (current_page.path == "v9/govuk_design_patterns/statistics/index.html") %> class="current-page"<% end %>><a href="/v9/govuk_design_patterns/statistics">Pattern statistics</a></li>
</ul>


            </nav>
          </div>
        </div>

        <div class="app-pane__content">
          <main id="content" class="technical-documentation markdown" data-module="anchored-headings">

          <div class="pattern-header">

            <p class="section-heading"><%= section %></p>
            <h1><%= title %><span class="status"><%= status %></span></h1>

            <div class="tabs-multi-page">
              <div class="tab"><a href="<%= url %>">Guide</a></div>
              <div class="tab"><a href="<%= url %>code.html">Code</a></div>
              <div class="tab current"><a href="<%= url %>discussion.html">Discussion</a></div>
            </div>

          </div>

          <p>You can discuss this pattern on the Hackpad below.</p>

          <p>
            Please note that this is not formal Cabinet Office guidance. <br>
            All views expressed are those of the individual contributors. 
          </p>

          <div class="hackpad">
            <script src="<%= discuss %>.js"></script><noscript><div>View <a href="<%= discuss %>">Tables</a> on Hackpad.</div></noscript>
          </div> 

          </main>
        </div>
      </div>
    </div>
  </body>
</html>
